<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anunciar Produto - Reusemi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="shortcut icon" href="/img/web/favicon-32x32.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/anunciar.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header>
    <div class="header-esquerda">
        <a href="/"><img class="logo" src="/img/web/logo.png" alt="logo"></a>

        <!-- Botão Hamburguer para Mobile -->
        <button class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <form action="/buscar" method="GET">
            <input class="pesquisar" type="search" name="q" placeholder="Pesquisar...">
            <button class="buscar" type="submit">Buscar</button>
        </form>
    </div>

    <div class="header-group-links" id="headerLinks">
        <nav>
            <a class="header-link" href="/">Início</a>
            <a class="header-link" href="/perfil">Meus anúncios</a>
        </nav>
        <a class="header-special" href="/products">Anuncie Grátis</a>
    </div>
</header>

<div class="linha-fina"></div>

<div class="anuncio-container">
    <h1 class="anuncio-titulo">Anunciar Produto</h1>

    <form action="/products/save" method="post" enctype="multipart/form-data" id="form-anuncio" class="anuncio-form">
        <div class="form-coluna">
            <div class="form-grupo">
                <label for="name">Título do anúncio *</label>
                <input type="text" id="name" name="name" required
                       placeholder="Ex: Smartphone Samsung Galaxy S20 em ótimo estado">
            </div>

            <div class="form-grupo">
                <label for="categoria">Categoria *</label>
                <select id="categoria" name="categoryId" required>
                    <option value="">Selecione uma categoria</option>
                    <option value="1">Eletrônicos</option>
                    <option value="2">Móveis</option>
                    <option value="3">Moda</option>
                    <option value="4">Esportes</option>
                    <option value="5">Veículos</option>
                    <option value="6">Imóveis</option>
                    <option value="7">Produtos Reciclados</option>
                </select>
            </div>

            <div class="form-grupo">
                <label for="tipo-negociacao">Tipo de negociação *</label>
                <select id="tipo-negociacao" name="tipoNegociacao" required>
                    <option value="">Selecione uma opção</option>
                    <option value="troca">Troca</option>
                    <option value="doacao">Doação</option>
                </select>
            </div>

            <div class="form-grupo">
                <label for="valor-troca">O que você deseja em troca? *</label>
                <input type="text" id="valor-troca" name="valorTroca" required
                       placeholder="Ex: Troco por bicicleta ou notebook">
                <small>Descreva o que você aceita em troca (produtos, valores, etc.)</small>
            </div>

            <div class="form-grupo">
                <label for="condicao">Condição do produto *</label>
                <select id="condicao" name="condicao" required>
                    <option value="">Selecione uma opção</option>
                    <option value="novo">Novo</option>
                    <option value="usado">Usado</option>
                    <option value="recondicionado">Recondicionado</option>
                </select>
            </div>

            <div class="form-grupo">
                <label for="description">Descrição *</label>
                <textarea id="description" name="description" required
                          placeholder="Descreva detalhadamente o produto, incluindo marcas, modelo, estado de conservação, acessórios incluídos, etc."></textarea>
            </div>
        </div>

        <div class="form-coluna">
            <div class="form-grupo">
                <label>Foto do produto *</label>
                <div class="upload-area" id="upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Clique para adicionar uma foto ou arraste e solte</p>
                    <p><small>Formatos: JPG, PNG (máx. 5MB)</small></p>
                </div>
                <!-- CORREÇÃO: Removido multiple e adicionado required -->
                <input type="file" id="imageFile" name="imageFile" accept="image/*" style="display: none;" required>
                <div id="imagens-preview"></div>
                <small id="image-error" style="color: red; display: none;">Por favor, selecione uma imagem</small>
            </div>

            <div class="form-grupo">
                <label for="localizacao">Localização *</label>
                <input type="text" id="localizacao" name="localizacao" required
                       placeholder="Ex: São Paulo, SP">
            </div>

            <div class="form-grupo">
                <label for="contato">Contato *</label>
                <input type="text" id="contato" name="contato" required
                       placeholder="Telefone, WhatsApp ou e-mail">
            </div>

            <!-- Campos ocultos para manter compatibilidade com o backend -->
            <input type="hidden" id="price" name="price" value="0">
            <input type="hidden" id="discount" name="discount" value="0">

            <div class="form-grupo checkbox-group">
                <input type="checkbox" id="featured" name="featured" value="true">
                <label for="featured">Destacar este produto</label>
            </div>
        </div>

        <div class="botoes-anuncio">
            <a href="/perfil" class="btn btn-cancelar">Cancelar</a>
            <button type="submit" class="btn btn-publicar">Publicar Anúncio</button>
        </div>
    </form>
</div>

<footer>
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Reusemi</h3>
                <p>O lugar ideal para comprar, vender e contribuir <br>com o meio ambiente através da reciclagem e<br>reutilização de produtos.</p>
            </div>

            <div class="footer-section">
                <h3>Links Úteis</h3>
                <ul>
                    <li><a href="#">Como vender</a></li>
                    <li><a href="#">Dicas de segurança</a></li>
                    <li><a href="#">Perguntas frequentes</a></li>
                    <li><a href="#">Sustentabilidade</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Contato</h3>
                <ul>
                    <li><a href="#">Fale conosco</a></li>
                    <li><a href="#">Anuncie</a></li>
                    <li><a href="#">Trabalhe conosco</a></li>
                    <li><a href="#">Seja um parceiro</a></li>
                </ul>
            </div>
        </div>

        <div class="copyright">
            <p>&copy; 2025 REUSEMI - Todos os direitos reservados. ♻️</p>
        </div>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Elementos do formulário
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('imageFile');
        const imagensPreview = document.getElementById('imagens-preview');
        const formAnuncio = document.getElementById('form-anuncio');
        const imageError = document.getElementById('image-error');
        const tipoNegociacao = document.getElementById('tipo-negociacao');
        const valorTrocaInput = document.getElementById('valor-troca');

        // Variável para controlar se uma imagem foi selecionada
        let imagemSelecionada = null;

        // Evento para abrir o seletor de arquivos ao clicar na área de upload
        uploadArea.addEventListener('click', function() {
            fileInput.click();
        });

        // Evento para processar arquivo selecionado
        fileInput.addEventListener('change', function(e) {
            const files = e.target.files;

            if (files.length > 0) {
                const file = files[0];

                // Verificar se é uma imagem
                if (!file.type.match('image.*')) {
                    alert('Por favor, selecione apenas imagens (JPG, PNG).');
                    fileInput.value = '';
                    return;
                }

                // Verificar tamanho do arquivo (máx 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('A imagem deve ter no máximo 5MB.');
                    fileInput.value = '';
                    return;
                }

                imagemSelecionada = file;
                imageError.style.display = 'none';

                // Limpar preview anterior
                imagensPreview.innerHTML = '';

                // Criar preview
                const reader = new FileReader();

                reader.onload = function(e) {
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'imagem-preview';

                    const img = document.createElement('img');
                    img.src = e.target.result;

                    const btnRemover = document.createElement('button');
                    btnRemover.className = 'remover-imagem';
                    btnRemover.innerHTML = '×';
                    btnRemover.type = 'button';

                    // Evento para remover a imagem
                    btnRemover.addEventListener('click', function() {
                        imagemSelecionada = null;
                        fileInput.value = '';
                        previewDiv.remove();
                        imageError.style.display = 'block';
                    });

                    previewDiv.appendChild(img);
                    previewDiv.appendChild(btnRemover);
                    imagensPreview.appendChild(previewDiv);
                };

                reader.readAsDataURL(file);
            }
        });

        // Permitir arrastar e soltar imagens
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgb(128, 231, 26)';
            uploadArea.style.backgroundColor = 'rgba(128, 231, 26, 0.1)';
        });

        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#ccc';
            uploadArea.style.backgroundColor = 'transparent';
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#ccc';
            uploadArea.style.backgroundColor = 'transparent';

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;

                // Disparar evento change manualmente
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        });

        // Validação do formulário
        formAnuncio.addEventListener('submit', function(e) {
            if (!imagemSelecionada) {
                e.preventDefault();
                imageError.style.display = 'block';
                uploadArea.scrollIntoView({ behavior: 'smooth' });
                alert('Por favor, selecione uma imagem para o produto.');
            }
        });

        // Atualizar placeholder baseado no tipo de negociação
        tipoNegociacao.addEventListener('change', function() {
            if (this.value === 'doacao') {
                valorTrocaInput.placeholder = "Descreva para quem gostaria de doar (opcional)";
                valorTrocaInput.required = false;
            } else {
                valorTrocaInput.placeholder = "Ex: Troco por bicicleta ou notebook";
                valorTrocaInput.required = true;
            }
        });
    });
</script>
</body>
</html>